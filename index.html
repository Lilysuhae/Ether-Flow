<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://npmcdn.com https://unpkg.com; 
               style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://npmcdn.com https://unpkg.com; 
               font-src 'self' data: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; 
               img-src 'self' data:; 
               connect-src 'self';">
    <title data-i18n="window.title">Ether Flow</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app">
        <div class="window-controls">
            <button id="pin-btn" class="win-btn active" onclick="window.toggleAlwaysOnTop()" data-i18n="window.tooltip.pin" data-tooltip="항상 위에 고정">
                <i class="fas fa-thumbtack"></i>
            </button>
            <button class="win-btn" onclick="window.toggleSettings(true)" data-i18n="window.tooltip.settings" data-tooltip="설정">
                <i class="fas fa-cog"></i>
            </button>
            <button class="win-btn" onclick="window.minimizeApp()" data-i18n="window.tooltip.minimize" data-tooltip="최소화">
                <i class="fas fa-minus"></i>
            </button>
            <button class="win-btn close" onclick="window.askClose()" data-i18n="window.tooltip.close" data-tooltip="종료">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <header id="drag-header">
            <div class="header-left">
                <h2 class="ether-glow-title" data-i18n="window.title">Ether Flow</h2>
            </div>
            <div class="header-right">
                <span id="work-points">0 Et</span>
                <span id="status-badge" class="waiting" data-i18n="header.status.waiting">
                    <i class="fas fa-hourglass-start"></i> 대기 중
                </span>
            </div>
        </header>

        <div id="main-layout">
            <div id="left-side">
                <div id="game-view">
                    <div id="mailbox-messenger" onclick="window.toggleMailbox(true)" style="display: none;">
                        <i class="fa-solid fa-envelope-open-text"></i>
                        <span class="messenger-glow"></span>
                    </div>

                    <div id="intimacy-display">
                        <div class="intimacy-info-row">
                            <span id="char-name-tag" data-i18n="game.character.default_name">알</span>
                            <span id="intimacy-stat"><i class="fas fa-heart"></i> <span id="intimacy-val">0.0</span></span>
                        </div>
                        <div class="intimacy-container">
                            <div id="intimacy-bar"></div>
                        </div>
                    </div>

                    <div id="character-container">
                        <canvas id="main-canvas"></canvas>
                    </div>

                    <div id="dialogue-bubble" class="speech-bubble" onclick="window.closeDialogue()">
                        <p id="dialogue-text"></p>
                    </div>

                    <div id="hatch-flash"></div>

                    <div id="stats-area">
                        <div class="stats-header">
                            <span id="level-display">LV.<span id="level-num">1</span></span>
                            <span id="exp-percent"></span>
                        </div>
                        <div class="progress-container">
                            <div id="exp-bar"></div>
                        </div>
                        <div class="time-stats">
                            <div class="time-item"><span data-i18n="game.stats.today">오늘</span> <b id="today-time">00:00:00</b></div>
                            <div class="time-item"><span data-i18n="game.stats.total">누적</span> <b id="total-time">00:00:00</b></div>
                        </div>
                    </div>

                    <div id="gold-mini-player">
                        <div class="player-node" id="node-ambient">
                            <div id="panel-ambient" class="player-panel">
                                <div class="panel-header">AMBIENT</div>
                                <div id="list-ambient" class="track-list"></div>
                                <div class="control-bar">
                                    <button class="ctrl-btn prev-btn" data-type="ambient"><i class="fa-solid fa-backward-step"></i></button>
                                    <button class="ctrl-btn play-btn" id="play-amb"><i class="fa-solid fa-play"></i></button>
                                    <button class="ctrl-btn next-btn" data-type="ambient"><i class="fa-solid fa-forward-step"></i></button>
                                    <input type="range" class="vol-slider" id="vol-amb" min="0" max="1" step="0.01" value="0.3">
                                    <button class="ctrl-btn loop-btn" id="loop-amb" title="한 곡 반복"><i class="fa-solid fa-repeat"></i></button>
                                    <button class="ctrl-btn shuffle-btn" id="shuffle-amb" title="순서 섞기"><i class="fa-solid fa-shuffle"></i></button>
                                </div>
                            </div>
                            <div class="trigger-icon" id="trig-amb"><i class="fa-solid fa-wind"></i></div>
                        </div>

                        <div class="player-node" id="node-music">
                            <div id="panel-music" class="player-panel">
                                <div class="panel-header">MUSIC</div>
                                <div id="list-music" class="track-list"></div>
                                <div class="control-bar">
                                    <button class="ctrl-btn prev-btn" data-type="music"><i class="fa-solid fa-backward-step"></i></button>
                                    <button class="ctrl-btn play-btn" id="play-mus"><i class="fa-solid fa-play"></i></button>
                                    <button class="ctrl-btn next-btn" data-type="music"><i class="fa-solid fa-forward-step"></i></button>
                                    <input type="range" class="vol-slider" id="vol-mus" min="0" max="1" step="0.01" value="0.4">
                                    <button class="ctrl-btn loop-btn" id="loop-mus" title="한 곡 반복"><i class="fa-solid fa-repeat"></i></button>
                                    <button class="ctrl-btn shuffle-btn" id="shuffle-mus" title="순서 섞기"><i class="fa-solid fa-shuffle"></i></button>
                                </div>
                            </div>
                            <div class="trigger-icon" id="trig-mus"><i class="fa-solid fa-music"></i></div>
                        </div>
                    </div>
                </div>

                <div class="control-group game">
                    <label class="group-label">Alchemy & Connection</label>
                    <div class="action-row">
                        <button class="btn btn-game" onclick="window.openShop()">
                            <i class="fas fa-gift"></i><span data-i18n="game.actions.shop">상점</span>
                        </button>
                        <button class="btn btn-game" onclick="window.openInventory()">
                            <i class="fa-solid fa-bag-shopping"></i><span data-i18n="game.actions.inventory">가방</span>
                        </button>
                        <button class="btn btn-game" onclick="window.openSedimentModal()">
                            <i class="fas fa-egg"></i> <span data-i18n="game.actions.craft">연성</span>
                        </button>
                        <button class="btn btn-game" onclick="window.toggleAchievementModal(true)">
                            <i class="fas fa-medal"></i><span data-i18n="game.actions.achievement">업적</span>
                        </button>
                        <button class="btn btn-game" onclick="window.toggleCollection(true)">
                            <i class="fas fa-book-bookmark"></i><span data-i18n="game.actions.collection">도감</span>
                        </button>
                        <button class="btn btn-game" onclick="window.toggleMailbox(true)">
                            <i class="fas fa-envelope"></i><span data-i18n="game.actions.mailbox">서신</span>
                            <span id="mail-badge" class="mail-badge" style="display: none;">0</span>
                        </button>
                    </div>
                </div>

                <div class="control-group focus">
                    <label class="group-label">Work</label>
                    <div class="action-row">
                        <button class="btn btn-task" onclick="window.openDailyLog()">
                            <i class="fas fa-chart-pie"></i><span data-i18n="game.actions.log">작업기록</span>
                        </button>
                        <button class="btn btn-task" onclick="" disabled>
                            <i class="fa-solid fa-stopwatch"></i><span>준비중</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="controls" class="right-side">
                <div class="control-group focus">
                    <label class="group-label" data-i18n="sidebar.work_tool.title">사용중인 작업 도구</label>
                    <div id="current-app-box" class="current-app-box">
                        <i class="fa-regular fa-window-restore"></i>
                        <span id="current-app-name" data-i18n="sidebar.work_tool.detecting">활성 창 감지 중...</span>
                        <button class="btn-add-current" onclick="window.addCurrentApp()" data-i18n="sidebar.work_tool.add_tooltip" data-tooltip="작업 도구 등록">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <div id="work-apps-accordion" class="accordion active">
                        <div class="accordion-header" onclick="window.toggleAccordion('work-apps-accordion')">
                            <span class="group-label" data-i18n="sidebar.work_tool.registered">등록된 작업 도구</span>
                            <i class="fas fa-chevron-down accordion-icon"></i>
                        </div>
                        <div class="accordion-content">
                            <ul id="work-app-list"></ul>
                        </div>
                    </div>

                    <div id="molip-habit-accordion" class="accordion active">
                        <div class="accordion-header" onclick="window.toggleAccordion('molip-habit-accordion')">
                            <div class="accordion-title-group"> 
                                <span class="group-label" data-i18n="sidebar.habit.title">매일의 습관</span>
                                <span id="habit-count-badge" class="count-badge">0/0</span>
                            </div>
                            <i class="fas fa-chevron-down accordion-icon"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="habit-register-box">
                                <div class="habit-input-main">
                                    <input type="text" id="habit-input" data-i18n="sidebar.habit.placeholder" placeholder="습관 이름 입력">
                                    <button class="btn-todo-add" onclick="window.addHabit()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                
                                <div class="habit-options-row">
                                    <div id="habit-day-selector" class="day-selector">
                                        <button type="button" class="day-btn" data-day="1">월</button>
                                        <button type="button" class="day-btn" data-day="2">화</button>
                                        <button type="button" class="day-btn" data-day="3">수</button>
                                        <button type="button" class="day-btn" data-day="4">목</button>
                                        <button type="button" class="day-btn" data-day="5">금</button>
                                        <button type="button" class="day-btn" data-day="6">토</button>
                                        <button type="button" class="day-btn" data-day="0">일</button>
                                    </div>
                                    <input type="text" id="habit-time-input" class="habit-time-input" placeholder="시간 선택">
                                </div>
                            </div>
                            <ul id="habit-list" class="todo-list-container"></ul>
                        </div>
                    </div>

                    <div id="molip-todo-accordion" class="accordion active">
                        <div class="accordion-header" onclick="window.toggleAccordion('molip-todo-accordion')">
                            <div class="accordion-title-group"> <span class="group-label" data-i18n="sidebar.todo.title">오늘의 할 일</span>
                                <span id="todo-count-badge" class="count-badge">0/0</span>
                            </div>
                            <i class="fas fa-chevron-down accordion-icon"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="todo-input-container">
                                <select id="todo-priority-select" title="중요도 설정">
                                    <option value="low">⚪ 보통</option>
                                    <option value="mid">🟡 중요</option>
                                    <option value="high">🔴 긴급</option>
                                </select>

                                <input type="text" id="todo-input" data-i18n="sidebar.todo.placeholder" placeholder="할 일 등록">

                                <div class="date-picker-wrapper">
                                    <input type="text" id="todo-deadline-input" placeholder="기한 선택">
                                    <button id="btn-deadline-trigger" onclick="document.getElementById('todo-deadline-input')._flatpickr.open()">
                                        <i class="fas fa-clock"></i>
                                    </button>
                                </div>

                                <button class="btn-todo-add" onclick="window.addMolipTodo()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <ul id="todo-list" class="todo-list-container"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="effect-layer"></div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-window">
            <div class="modal-header">
                <h3><span data-i18n="settings.title">시스템</span></h3>
                <button class="win-btn" onclick="window.toggleSettings(false)"><i class="fas fa-times"></i></button>
            </div>
            <div class="settings-tabs">
                <button id="btn-tab-general" class="tab-btn active" onclick="window.switchSettingsTab('general')"><i class="fa-solid fa-gear"></i></button>
                <button id="btn-tab-sound" class="tab-btn" onclick="window.switchSettingsTab('sound')"><i class="fa-solid fa-volume-high"></i></button>
                <button id="btn-tab-apps" class="tab-btn" onclick="window.switchSettingsTab('apps')"><i class="fa-solid fa-list-check"></i></button>
                <button id="btn-tab-distract" class="tab-btn" onclick="window.switchSettingsTab('distract')"><i class="fa-solid fa-ghost"></i></button>
                <button id="btn-tab-monitor" class="tab-btn" onclick="window.switchSettingsTab('monitor')"><i class="fa-solid fa-quote-left"></i></button>
                <button id="btn-tab-user" class="tab-btn" onclick="window.switchSettingsTab('user')"><i class="fa-solid fa-user"></i></button>
                <button id="btn-tab-etc" class="tab-btn" onclick="window.switchSettingsTab('etc')"><i class="fa-solid fa-ellipsis"></i></button>
            </div>
            <div class="settings-body">
                <div id="tab-content-general" class="tab-content active">
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.general.language">언어</label>
                        <div class="pretty-select-container">
                            <select id="language-select" class="pretty-select" disabled style="opacity: 0.6; cursor: not-allowed;">
                                <option value="ko">한국어</option>
                                <option value="en">English (Locked)</option>
                            </select>
                            <i class="fas fa-lock select-arrow"></i> </div>
                        <p class="setting-hint">
                            연금술 길드에서 언어 확장 작업을 진행 중입니다.
                        </p>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.general.font">폰트</label>
                        <div class="pretty-select-container">
                            <select id="font-select" class="pretty-select" onchange="window.changeFont(this.value)">
                                <option value="paperlogy">페이퍼로지</option>
                                <option value="Pretendard">프리텐다드</option>
                                <option value="NanumSquareNeo">나눔스퀘어 네오</option>
                                <option value="Galmuri11">갈무리9</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.general.theme">테마</label>
                        <div class="pretty-radio-group">
                            <label class="pretty-radio">
                                <input type="radio" name="theme-choice" value="DEFAULT_DARK" onchange="window.changeTheme('DEFAULT_DARK')">
                                <div class="radio-content"><span>다크</span></div>
                            </label>
                            <label class="pretty-radio">
                                <input type="radio" name="theme-choice" value="DEFAULT_LIGHT" onchange="window.changeTheme('DEFAULT_LIGHT')">
                                <div class="radio-content"><span>라이트</span></div>
                            </label>
                            <label class="pretty-radio">
                                <input type="radio" name="theme-choice" value="ALCHEMY_LAB" onchange="window.changeTheme('ALCHEMY_LAB')">
                                <div class="radio-content"><span>연구실</span></div>
                            </label>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.general.layout">화면 레이아웃</label>
                        <div class="window-mode-btns">
                            <button id="btn-layout-horizontal" onclick="window.changeWindowMode('horizontal')">가로</button>
                            <button id="btn-layout-vertical" onclick="window.changeWindowMode('vertical')">세로</button>
                            <button id="btn-layout-mini" onclick="window.changeWindowMode('mini')">미니</button>
                        </div>
                    </div>
                </div>
                <div id="tab-content-sound" class="tab-content" style="display: none;">
                    <div class="settings-group">
                        <label class="settings-label">프로그램 실행 시 배경음 자동 재생</label>
                        <div id="auto-play-toggle" class="window-mode-toggle" onclick="window.toggleAutoPlay('autoPlay')">
                            <span>자동 재생 켜기</span>
                            <div class="switch-base"><div class="switch-circle"></div></div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">소리 크기 조정</label>
                        <div class="sound-control-row">
                            <div class="sound-label">버튼 및 상호작용</div>
                            <div class="sound-controls-flex">
                                <button id="mute-sfx" class="btn-sound-mute" onclick="window.toggleMute('sfx')">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input type="range" id="vol-sfx" class="sound-slider" min="0" max="100" value="80" 
                                    oninput="window.updateVolume('sfx', this.value)">
                            </div>
                        </div>

                        <div class="sound-control-row">
                            <div class="sound-label">서신 및 시스템 알림</div>
                            <div class="sound-controls-flex">
                                <button id="mute-notif" class="btn-sound-mute" onclick="window.toggleMute('notif')">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input type="range" id="vol-notif" class="sound-slider" min="0" max="100" value="80" 
                                    oninput="window.updateVolume('notif', this.value)">
                            </div>
                        </div>

                        <div class="sound-control-row">
                            <div class="sound-label">몰입 및 타이머</div>
                            <div class="sound-controls-flex">
                                <button id="mute-timer" class="btn-sound-mute" onclick="window.toggleMute('timer')">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input type="range" id="vol-timer" class="sound-slider" min="0" max="100" value="100" 
                                    oninput="window.updateVolume('timer', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">연성 알림</label>
                        <div id="cylinder-toast-toggle" class="window-mode-toggle" onclick="window.toggleCylinderToast()">
                            <span>부산물 획득 알림 표시</span>
                            <div class="switch-base">
                                <div class="switch-circle"></div>
                            </div>
                        </div>
                        <p class="setting-hint">실린더에서 부산물을 건져 올렸을 때 하단에 뜨는 안내 메시지를 설정합니다.</p>
                    </div>
                </div>
                <div id="tab-content-apps" class="tab-content" style="display: none;">
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.work.reset_time">일과 초기화 기준 시간</label>
                        <div class="pretty-select-container">
                            <select id="reset-hour-select" class="pretty-select" onchange="window.changeResetHour(this.value)">
                                <option value="0">오전 00:00 (자정)</option>
                                <option value="4">오전 04:00 (새벽)</option>
                                <option value="5">오전 05:00 (새벽)</option>
                                <option value="6">오전 06:00 (아침)</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                        <p class="setting-hint" data-i18n="settings.work.reset_hint">설정한 시간 이전의 작업은 '어제' 기록으로 합산됩니다.</p>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.work.todo_manage">오늘의 할일 목록 관리</label>
                        <div id="hide-completed-toggle" class="window-mode-toggle" onclick="window.toggleHideCompleted()">
                            <span data-i18n="settings.work.hide_completed">완료된 항목 숨기기</span>
                            <div id="hide-completed-switch" class="switch-base">
                                <div class="switch-circle"></div>
                            </div>
                        </div>
                        <div id="show-past-toggle" class="window-mode-toggle" style="margin-top: 8px;" onclick="window.toggleShowPast()">
                            <span data-i18n="settings.work.show_past">이전에 등록한 항목 표시</span>
                            <div class="switch-base">
                                <div class="switch-circle"></div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.work.optimization">데이터 최적화</label>
                        <div id="auto-delete-toggle" class="window-mode-toggle" onclick="window.toggleAutoDelete()">
                            <span data-i18n="settings.work.auto_delete">7일 지난 할 일 완료 항목 자동 삭제</span>
                            <div class="switch-base">
                                <div class="switch-circle"></div>
                            </div>
                        </div>
                        <p class="setting-hint" data-i18n="settings.work.auto_delete_hint">완료된 지 일주일이 지난 할 일들을 자동으로 정리합니다.</p>
                    </div>
                </div>
                <div id="tab-content-distract" class="tab-content" style="display: none;">
                    <div class="settings-group">
                        <label class="settings-label" data-i18n="settings.distract.current_reg">현재 실행 중인 도구 등록</label>
                        <div class="current-app-box" style="margin-bottom: 10px;">
                            <i class="fas fa-ghost"></i>
                            <span id="current-distract-name">도구 감지 중...</span>
                            <button class="btn-add-current btn-danger" onclick="window.addDistractionApp()" data-i18n="settings.distract.add_tooltip" data-tooltip="딴짓 차단 등록" style="background: var(--danger-red) !important;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>

                        <div id="distract-apps-accordion" class="accordion active">
                            <div class="accordion-header" onclick="window.toggleAccordion('distract-apps-accordion')">
                                <label class="settings-label" data-i18n="settings.distract.registered_list">등록된 딴짓 도구 목록</label>
                                <i class="fas fa-chevron-down accordion-icon"></i>
                            </div>
                            <div class="accordion-content">
                                <ul id="distract-app-list-settings" class="work-app-container"></ul>
                            </div>
                        </div>
                    </div>
                    <p class="setting-hint" data-i18n="settings.distract.hint">여기에 등록된 도구를 사용하면 딴짓임을 감지하고 상태 뱃지에 <b>딴짓 중</b>으로 표시됩니다.</p>
                </div>
                <div id="tab-content-monitor" class="tab-content" style="display: none;">
                    <div class="settings-section">
                        <div class="keyword-input-group">
                            <div class="pretty-select-container">
                                <select id="keyword-type-select" class="pretty-select">
                                    <option value="work">작업</option>
                                    <option value="distract">딴짓</option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                            <input type="text" id="keyword-input" class="glass-input input-keyword" placeholder="감지 키워드 입력">
                            <button class="btn-buy-glass btn-add-keyword" onclick="window.addKeyword()"><i class="fas fa-plus"></i></button>
                        </div>
                        <p class="setting-hint">활성화된 창 제목에 아래 키워드가 포함되면 상태가 자동으로 전환됩니다.</p>
                        <div class="keyword-lists-container">
                            <div class="keyword-list-box">
                                <div class="list-label label-work">작업 도구</div>
                                <ul id="work-keyword-list" class="glass-keyword-list"></ul>
                            </div>
                            <div class="keyword-list-box">
                                <div class="list-label label-distract">딴짓 도구</div>
                                <ul id="distract-keyword-list" class="glass-keyword-list"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="tab-content-user" class="tab-content" style="display: none;">
                    <div class="settings-group">
                        <div class="account-info-box">
                            <label class="settings-label" for="user-id-display">유저 ID</label>
                            <div class="user-id-container">
                                <input type="text" id="user-id-display" readonly value="아이디 생성 중...">
                                <button class="btn-copy-id" onclick="window.copyUserId()" title="아이디 복사">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <p class="setting-hint">이 코드는 다른 사용자들과 겹치지 않는 고유 식별자입니다.</p>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">코드 등록</label>
                        <div class="gift-code-box">
                            <div class="user-id-container">
                                <input type="text" id="gift-code-input" placeholder="코드를 입력하세요">
                                <button class="btn-copy-id" onclick="window.redeemGiftCode()" title="코드 사용">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group last">
                        <label class="settings-label" data-i18n="settings.general.">데이터 초기화</label>
                        <button class="btn btn-danger" style="width: 100%;" onclick="window.resetAllData()" data-i18n="settings.general.reset_btn">전체 데이터 초기화</button>
                    </div>
                </div>
                <div id="tab-content-etc" class="tab-content" style="display: none;">
                    <div class="settings-section">
                        <label class="settings-label" data-i18n="settings.general.">버전 정보</label>
                        <p>V 0.5.6</p>
                    </div>
                    <div class="settings-section">
                        <label class="settings-label" data-i18n="settings.general.">제작자</label>
                        <div>
                            TEAM.Lily Orbit
                            <a href="https://x.com/snowflor_lily" onclick="event.preventDefault(); require('electron').shell.openExternal(this.href)" data-tooltip="트위터 바로가기">
                                <i class="fa-brands fa-twitter"></i>
                            </a>
                        </div>
                    </div>
                    <div class="settings-section last">
                        <label class="settings-label" data-i18n="settings.general.">감사한 분들</label>
                        <ul>
                            <li>Duraena</li>
                            <li>Latimeria</li>
                            <li>GAMANG</li>
                            <li>Hyeon</li>
                            <li>nari</li>
                            <li>Vitte</li>
                            <li>Jelly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="inventory-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window inventory-window-vertical">
            <div class="modal-header">
                <div class="header-title">
                    <h3 data-i18n="modals.inventory.title">가방</h3>
                </div>
                <button class="close-btn" onclick="window.closeInventory()">&times;</button>
            </div>

            <div class="shop-tab-bar">
                <button class="shop-tab-re active" onclick="window.switchInventoryTab('gift', this)">선물</button>
                <button class="shop-tab-re" onclick="window.switchInventoryTab('material', this)">연성재료</button>
                <button class="shop-tab-re" onclick="window.switchInventoryTab('special', this)">소중한 물건</button>
            </div>

            <div id="inventory-grid" class="inventory-grid-section"></div>

            <div id="inventory-detail" class="inventory-detail-section">
                <div class="empty-bag-msg">아이템을 선택해 주세요.</div>
            </div>
        </div>
    </div>

    <div id="mailbox-modal" class="modal-overlay">
        <div class="modal-window mailbox-window">
            <div class="modal-header">
                <h3 data-i18n="modals.mailbox.title">전해진 서신</h3>
                <button class="win-btn" onclick="window.toggleMailbox(false)"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="shop-tab-bar" style="margin-bottom: 10px;">
                <button class="shop-tab-re active" onclick="window.switchMailTab('unread', this)">읽지 않음</button>
                <button class="shop-tab-re" onclick="window.switchMailTab('reward', this)">보상 미수령</button>
                <button class="shop-tab-re" onclick="window.switchMailTab('read', this)">읽음</button>
                <button class="shop-tab-re" onclick="window.switchMailTab('archive', this)">보관함</button>
            </div>

            <div id="mail-list" class="mail-list-container"></div>
        </div>
    </div>

    <div id="letter-view-modal" class="modal-overlay" style="display: none;">
        <div class="mail-paper-wrap">
            <div class="mail-paper">
                <div class="letter-header">
                    <h2 id="letter-detail-title"></h2>
                    <div id="letter-detail-sender"></div>
                    <button id="btn-mail-archive" class="btn-archive-star" onclick="window.toggleArchive()" title="보관함으로 보내기">
                        <i class="fa-regular fa-star"></i>
                    </button>
                </div>
                <div id="letter-view-content"></div>
                <div id="letter-reward-zone"></div>
                <div class="letter-footer">
                    <button class="btn-letter-close" onclick="window.closeLetterView()" data-i18n="modals.mailbox.btn_close">접어두기</button>
                </div>
            </div>
        </div>
    </div>

    <div id="sediment-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window glass">
            <div class="modal-header">
                <h3 data-i18n="modals.craft.title">연성 연구실</h3>
                <div class="header-btns">
                    <button class="win-btn" onclick="window.closeSedimentModal()"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <div class="shop-tab-bar">
                <button class="shop-tab-re active" onclick="window.switchAlchemyTab('general', this)">일반 연성</button>
                <button class="shop-tab-re" onclick="window.switchAlchemyTab('recipe', this)">조합 연성</button>
            </div>

            <div class="modal-body">
                <div id="alchemy-tab-general" class="alchemy-tab-content active">
                    <div class="saturation-area">
                        <div class="area-label"><span data-i18n="modals.craft.sat_label">현재 에테르 침전 농도</span> <span id="sat-value">0%</span></div>
                        <div class="sat-bar-container"><div id="sat-bar-fill" style="width: 0%;"></div></div>
                        <p class="sat-guide" data-i18n="modals.craft.sat_hint">할일에 몰입할수록 침전 농도가 오르며,<br>농도가 높을수록 파트너가 희귀한 부산물을 수집합니다.</p>
                    </div>
                    <div class="sediment-inventory">
                        <label data-i18n="modals.craft.inv_label">건져낸 부산물</label>
                        <div class="inventory-grid" id="sediment-grid"></div>
                    </div>
                    <div class="abyss-altar">
                        <h4 data-i18n="modals.craft.recipe_title">에테르 정제</h4>
                        <div class="recipe-check">
                            <div id="req-ether" class="req-item"><span class="dot"></span> 에테르 : <span class="val">0 / 10,000</span>Et</div>
                            <div id="req-sludge" class="req-item"><span class="dot"></span> 에테르 슬러지 : <span class="val">0 / 15</span></div>
                        </div>
                        <button id="btn-abyss-craft" class="btn-craft-large disabled" onclick="window.startAbyssCrafting()" data-i18n="modals.craft.btn_shortage">재료 부족</button>
                    </div>
                </div>

                <div id="alchemy-tab-recipe" class="alchemy-tab-content">
                    <div class="recipe-alembic-view">
                        <p class="recipe-guide">세 가지 재료를 조합하여 특정 동물의 영혼을 연성합니다.</p>
                        <div class="alembic-slots">
                            <div class="alembic-slot" id="recipe-slot-0" onclick="window.openIngredientPicker(0)">+</div>
                            <div class="alembic-slot" id="recipe-slot-1" onclick="window.openIngredientPicker(1)">+</div>
                            <div class="alembic-slot" id="recipe-slot-2" onclick="window.openIngredientPicker(2)">+</div>
                        </div>
                        <button id="btn-recipe-craft" class="btn-craft-large" onclick="window.startRecipeSynthesis()">
                            조합식 연성 실행
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="collection-modal" class="modal-overlay">
        <div class="modal-window">
            <div class="modal-header">
                <h3 data-i18n="game.actions.collection">도감</h3>
                <button class="win-btn" onclick="window.toggleCollection(false)"><i class="fas fa-times"></i></button>
            </div>
            <div id="collection-grid" class="grid-container"></div>
        </div>
    </div>

    <div id="char-detail-modal" class="modal-overlay">
        <div class="modal-window detail-window">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> <span data-i18n="game.actions.collection">호문클루스 정보</span></h3>
                <button class="win-btn" onclick="window.closeCharDetail()"><i class="fas fa-times"></i></button>
            </div>
            <div class="detail-body">
                <div class="detail-top-section">
                    <div class="detail-img-box"><img id="detail-char-img" src="" alt=""></div>
                    <div class="detail-main-stats">
                        <div class="detail-stat-item"><label data-i18n="game.character.label_name">이름</label><span id="detail-char-name">-</span></div>
                        <div class="detail-stat-item"><label data-i18n="game.character.label_stage">성장 단계</label><span id="detail-char-stage">-</span></div>
                        <div class="detail-stat-item"><label data-i18n="game.character.label_time">함께한 시간</label><span id="detail-total-companionship">0h 0m</span></div>
                    </div>
                </div>
                <div class="detail-progress-section">
                    <div class="detail-label-row"><label data-i18n="game.character.label_growth">성장 진행도</label><span id="detail-growth-text">0 / 1440 min</span></div>
                    <div class="progress-container">
                        <div id="detail-growth-bar"></div>
                    </div>
                </div>
                <div class="detail-desc-section"><label data-i18n="game.character.label_history">기록된 내력</label>
                    <p id="detail-char-desc"></p>
                </div>
                <div class="info-row preferences-block" style="display: block;">
                    <div class="pref-section" id="section-favorite">
                        <div class="pref-title fav" data-i18n="game.character.label_fav">
                            <i class="fas fa-heart"></i> 선호하는 선물
                        </div>
                        <div class="pref-items-container" id="list-favorite">
                        </div>
                    </div>

                    <div class="pref-section" id="section-dislike" style="margin-top: 12px;">
                        <div class="pref-title dis" data-i18n="game.character.label_dislike">
                            <i class="fas fa-skull"></i> 싫어하는 선물
                        </div>
                        <div class="pref-items-container" id="list-dislike">
                        </div>
                    </div>
                </div>
                <div class="detail-footer"><button id="detail-select-btn" class="btn btn-primary" style="width: 100%;" data-i18n="game.character.btn_select">파트너로 선택하기</button></div>
            </div>
        </div>
    </div>

    <div id="shop-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window glass-effect shop-window-glass">
            <div class="modal-header shop-header">
                <div class="header-title">
                    <h3 data-i18n="modals.shop.title">상점</h3>
                </div>
                <button class="close-btn" onclick="window.closeShop()">&times;</button>
            </div>

            <div class="shop-tab-bar">
                <button class="shop-tab-re active" data-target="gift" onclick="window.switchShopTab('gift', this)" data-i18n="modals.shop.tab_gift">선물</button>
                <button class="shop-tab-re" data-target="material" onclick="window.switchShopTab('material', this)" data-i18n="modals.shop.tab_material">연구 재료</button>
            </div>

            <div id="shop-grid" class="shop-grid-glass"></div>

            <div class="shop-footer-glass">
                <div class="shop-ether-info">
                    <span class="label" data-i18n="modals.shop.holding_ether">보유 에테르:</span>
                    <span id="shop-ether-count">0</span>
                    <span class="unit">Et</span>
                </div>
            </div>
        </div>
    </div>

    <div id="achievement-modal" class="modal-overlay">
        <div class="modal-window detail-window">
            <div class="modal-header">
                <h3 data-i18n="game.actions.achievement">업적</h3>
                <div class="header-btns">
                    <button class="win-btn" onclick="window.toggleAchievementModal(false)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="detail-body">
                <div id="achievement-grid" class="achievement-grid-vibe">
                </div>
            </div>
        </div>
    </div>

    <div id="daily-log-modal" class="modal-overlay">
        <div class="modal-window detail-window">
            <div class="modal-header">
                <h3 data-i18n="modals.log.title">작업기록</h3>
                <div class="header-btns">
                    <button class="win-btn" onclick="window.saveLogAsReceipt()" data-i18n="modals.log.tooltip_save" data-tooltip="영수증으로 저장"><i class="fas fa-camera"></i></button>
                    <button class="win-btn" onclick="window.closeDailyLog()"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <div class="log-date-nav">
                <button class="nav-btn" onclick="window.changeLogDate(-1)"><i class="fas fa-chevron-left"></i></button>
                <span id="log-date-display">2026. 01. 18</span>
                <button class="nav-btn" onclick="window.changeLogDate(1)"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="shop-tab-bar" style="margin-bottom: 15px;">
                <button class="shop-tab-re active" onclick="window.switchLogTab('list', this)" data-i18n="modals.log.tab_list">목록</button>
                <button class="shop-tab-re" onclick="window.switchLogTab('chart', this)" data-i18n="modals.log.tab_chart">통계</button>
            </div>

            <div id="daily-log-list" class="detail-body"></div>

            <div id="daily-log-chart-area" class="detail-body" style="display: none;">
                <div class="stat-container">
                    <div class="stat-label-row">
                        <span style="color: #a0c4ff;"><span data-i18n="modals.log.chart_work">집중</span> <b id="stat-work-percent">0%</b></span>
                        <span style="color: #ff6b6b;"><span data-i18n="modals.log.chart_distract">딴짓</span> <b id="stat-distract-percent">0%</b></span>
                    </div>
                    <div class="stat-gauge-total">
                        <div id="stat-bar-work" style="width: 50%; background: #a0c4ff; transition: width 0.5s ease;"></div>
                        <div id="stat-bar-distract" style="width: 50%; background: #ff6b6b; transition: width 0.5s ease;"></div>
                    </div>
                </div>

                <div class="stat-detail-group">
                    <label class="stat-group-label work"><i class="fas fa-fire"></i> <span data-i18n="modals.log.share_work">집중 점유율</span></label>
                    <div id="stat-detail-list" class="stat-scroll-area"></div>
                </div>

                <div class="stat-detail-group">
                    <label class="stat-group-label distract"><i class="fas fa-ghost"></i> <span data-i18n="modals.log.share_distract">딴짓 점유율</span></label>
                    <div id="stat-distract-detail-list" class="stat-scroll-area"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window confirm-window">
            <div class="confirm-content">
                <h3 id="confirm-title" style="color: var(--primary-gold);">확인</h3>
                <p id="confirm-message" style="margin-top: 15px; line-height: 1.6; color: white;"></p>
            </div>
            <div class="confirm-actions">
                <button id="confirm-no" class="btn btn-modal-cancel" data-i18n="modals.exit.no">아니오</button>
                <button id="confirm-yes" class="btn btn-modal-confirm" data-i18n="modals.exit.yes">예</button>
            </div>
        </div>
    </div>

    <div id="exit-confirm-modal" class="modal-overlay">
        <div class="modal-window confirm-window">
            <div class="confirm-content">
                <h3 data-i18n="modals.exit.title">연구 종료</h3>
                <p data-i18n="modals.exit.msg">오늘의 일정을 마치고 연구실을 나가시겠습니까?</p>
            </div>
            <div class="confirm-actions">
                <button class="btn btn-modal-cancel" onclick="window.closeAllModals()" data-i18n="modals.exit.no">아니오</button>
                <button class="btn btn-modal-confirm" onclick="window.quitApp()" data-i18n="modals.exit.yes">예</button>
            </div>
        </div>
    </div>

    <div id="receipt-wrapper">
        <div id="focus-receipt">
            <div class="receipt-header">
                <h2>ETHER FLOW</h2>
                <div class="receipt-info">
                    <p>RECEIPT NO: <span id="receipt-no">#0000</span></p>
                    <p>DATE: <span id="receipt-date">0000.00.00</span></p>
                    <p>PARTNER: <span id="receipt-char-name">-</span></p>
                </div>
            </div>
            <div class="receipt-divider"></div>
            <div id="receipt-items"></div>
            <div class="receipt-divider"></div>
            <div class="receipt-total"><span>TOTAL FOCUS</span><span id="receipt-total-time">00h 00m</span></div>
            <div class="barcode"></div>
            <div class="receipt-footer">
                <p class="thanks">THANK YOU FOR YOUR IMMERSION</p>
                <p class="signature">The Alchemist's Legacy</p>
            </div>
        </div>
    </div>

    <div id="alert-overlay" class="alert-overlay">
        <div class="alert-window">
            <div class="alert-content">
                <h3 id="alert-title">알림</h3>
                <p id="alert-message"></p>
            </div>
            <div class="alert-actions"><button class="btn btn-secondary" style="width: 100%; border-radius: 0 0 30px 30px;" onclick="window.closeAlert()">확인</button></div>
        </div>
    </div>
    <div id="toast-container" style="position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); z-index: 999999; pointer-events: none; display: flex; flex-direction: column; gap: 8px; align-items: center;"></div>

    <div id="intro-sequence">
        <div id="ritual-envelope" class="intro-step active" onclick="window.breakSeal()">
            <div class="envelope-body">
                <div class="seal-wax"></div>
            </div>
            <p class="click-guide" data-i18n="intro.seal_hint">편지의 봉인을 해제하여 확인하십시오.</p>
        </div>
        <div id="legacy-letter" class="intro-step" onclick="window.resonanceStage()">
            <div class="letter-paper">
                <div id="letter-content"></div>
            </div>
            <p class="click-guide" style="color: rgba(44, 44, 46, 0.5); margin-top: 20px;" data-i18n="intro.letter_from">이름 모를 연금술사로부터</p>
        </div>
        <div id="resonance-stage" class="intro-step">
            <h2 class="resonance-guide" data-i18n="intro.choice_guide">당신과 함께 할 호문클루스를 선택하세요.</h2>
            <div id="sphere-container"></div>
            <div id="ps-description"></div>
        </div>
    </div>

    <div id="intro-confirm-modal" class="modal-overlay" style="z-index: 600000; display: none;">
        <div class="modal-window confirm-window" style="border: 1px solid var(--primary-gold);">
            <div class="confirm-content">
                <h3 style="color: var(--primary-gold);" data-i18n="intro.confirm_title">알 선택</h3>
                <p id="intro-confirm-msg" style="margin-top: 15px; line-height: 1.6; color: white;"></p>
            </div>
            <div class="confirm-actions">
                <button class="btn btn-modal-cancel" onclick="window.closeIntroConfirm()" style="color: var(--text-secondary);" data-i18n="intro.btn_back">뒤로</button>
                <button id="intro-confirm-btn" class="btn btn-modal-confirm" style="color: var(--primary-gold); font-weight: 800;" data-i18n="intro.btn_confirm">확인</button>
            </div>
        </div>
    </div>

    <div id="common-tooltip" class="tooltip-box" style="display: none;"></div>
    <script type="module" src="renderer.js"></script>
</body>

</html>